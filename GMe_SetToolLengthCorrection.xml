<?xml version="1.0" encoding="utf-8"?>
<Method xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="C:\Program Files (x86)\Tecnomatix\MachineConfigurator\resource\mc_method.xsd">
  <Name>GMe_SetToolLengthCorrection</Name>
  <Variable>LV_matTool</Variable>
  <Variable>LV_vecToolRot</Variable>
  <Execute>
    <Command>
      <Name>ActivateTransformation</Name>
      <Param>"$TOOL"</Param>
      <Param>FALSE</Param>
      <Param>FALSE</Param>
    </Command>
    <Command>
      <Name>ResetTransformation</Name>
      <Param>"$TOOL"</Param>
    </Command>
    <Comment>If fixed tool axis turning and milling:</Comment>
    <IfCommand>
      <Condition>43 == getVariable("#4008")</Condition>
      <Then>
        <Comment>Create the rotated tool offsets in preparation</Comment>
        <AssignCommand>
          <Variable>LV_matTool</Variable>
          <Value>createMatrix()</Value>
        </AssignCommand>
        <Comment>Displace matrix in X, Y, Z directions according to tool in head at machine zero posture.</Comment>
        <Command>
          <Name>TranslateMatrix</Name>
          <Param>LV_matTool</Param>
          <Param>getLCorrection()+GV_dInkpol</Param>
          <Param>getZCorrection()</Param>
          <Param>-getQCorrection()</Param>
        </Command>
        <Command>
          <Name>RotateMatrixY</Name>
          <Param>LV_matTool</Param>
          <Param>getRadians(getTargetJointValue("B1","Machine"))</Param>
        </Command>
        <Command>
          <Name>RotateMatrixX</Name>
          <Param>LV_matTool</Param>
          <Param>getRadians(getTargetJointValue("FS1","Machine"))</Param>
        </Command>
        <AssignCommand>
          <Variable>LV_vecToolRot</Variable>
          <Value>getMatrixTranslation(LV_matTool)</Value>
        </AssignCommand>
        <Comment>If milling:</Comment>
        <IfCommand>
          <Condition>GV_bMilling</Condition>
          <Then>
            <Comment>If tool is in upper spindle unit:</Comment>
            <IfCommand>
              <Condition>("1" == getChannelName())</Condition>
              <Then>
                <Comment>If coordinate system has been rotated:</Comment>
                <IfCommand>
                  <Condition>GV_bSwivelingActive</Condition>
                  <Then>
                    <Command>
                      <Name>DisplaceOrigin</Name>
                      <Param>"$TOOL"</Param>
                      <Param>FALSE</Param>
                      <Param>getThirdAxis()</Param>
                      <Param>getLCorrection()+GV_dInkpol</Param>
                    </Command>
                    <Command>
                      <Name>DisplaceOrigin</Name>
                      <Param>"$TOOL"</Param>
                      <Param>FALSE</Param>
                      <Param>getSecondAxis()</Param>
                      <Param>getQCorrection()</Param>
                    </Command>
                    <Command>
                      <Name>DisplaceOrigin</Name>
                      <Param>"$TOOL"</Param>
                      <Param>FALSE</Param>
                      <Param>getFirstAxis()</Param>
                      <Param>getZCorrection()</Param>
                    </Command>
                  </Then>
                  <Else>
                    <Command>
                      <Name>DisplaceOrigin</Name>
                      <Param>"$TOOL"</Param>
                      <Param>FALSE</Param>
                      <Param>getFirstGeoAxis()</Param>
                      <Param>getVectorX(LV_vecToolRot)
</Param>
                    </Command>
                    <Command>
                      <Name>DisplaceOrigin</Name>
                      <Param>"$TOOL"</Param>
                      <Param>FALSE</Param>
                      <Param>getSecondGeoAxis()</Param>
                      <Param>getVectorY(LV_vecToolRot)</Param>
                    </Command>
                    <Command>
                      <Name>DisplaceOrigin</Name>
                      <Param>"$TOOL"</Param>
                      <Param>FALSE</Param>
                      <Param>getThirdGeoAxis()</Param>
                      <Param>getVectorZ(LV_vecToolRot)</Param>
                    </Command>
                  </Else>
                </IfCommand>
              </Then>
              <Else>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getFirstGeoAxis()</Param>
                  <Param>getLCorrection()
</Param>
                </Command>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getSecondGeoAxis()</Param>
                  <Param>getZCorrection()</Param>
                </Command>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getThirdGeoAxis()</Param>
                  <Param>getQCorrection()</Param>
                </Command>
              </Else>
            </IfCommand>
          </Then>
          <Else>
            <IfCommand>
              <Condition>("1" == getChannelName())</Condition>
              <Then>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getFirstGeoAxis()</Param>
                  <Param>getVectorX(LV_vecToolRot)</Param>
                </Command>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getSecondGeoAxis()</Param>
                  <Param>getVectorY(LV_vecToolRot)</Param>
                </Command>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getThirdGeoAxis()</Param>
                  <Param>getVectorZ(LV_vecToolRot)
</Param>
                </Command>
              </Then>
              <Else>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getFirstAxis()</Param>
                  <Param>-getQCorrection()</Param>
                </Command>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getSecondAxis()</Param>
                  <Param>getLCorrection()</Param>
                </Command>
                <Command>
                  <Name>DisplaceOrigin</Name>
                  <Param>"$TOOL"</Param>
                  <Param>FALSE</Param>
                  <Param>getThirdAxis()</Param>
                  <Param>getZCorrection()</Param>
                </Command>
                <Command>
                  <Name>Assert</Name>
                  <Param>FALSE</Param>
                  <Param>"warning"</Param>
                  <Param>"we are here in turret mode"</Param>
                </Command>
              </Else>
            </IfCommand>
          </Else>
        </IfCommand>
      </Then>
    </IfCommand>
    <Comment>If TCPC is activated:</Comment>
    <IfCommand>
      <Condition>434 == getVariable("#4008") OR 435 == getVariable("#4008")</Condition>
      <Then>
        <Command>
          <Name>DisplaceOrigin</Name>
          <Param>"$TOOL"</Param>
          <Param>FALSE</Param>
          <Param>getThirdAxis()</Param>
          <Param>getLCorrection()</Param>
        </Command>
        <Command>
          <Name>DisplaceOrigin</Name>
          <Param>"$TOOL"</Param>
          <Param>FALSE</Param>
          <Param>getSecondAxis()</Param>
          <Param>getQCorrection()</Param>
        </Command>
        <Command>
          <Name>DisplaceOrigin</Name>
          <Param>"$TOOL"</Param>
          <Param>FALSE</Param>
          <Param>getFirstAxis()</Param>
          <Param>getZCorrection()</Param>
        </Command>
      </Then>
    </IfCommand>
    <Command>
      <Name>ActivateTransformation</Name>
      <Param>"$TOOL"</Param>
      <Param>TRUE</Param>
      <Param>TRUE</Param>
    </Command>
  </Execute>
</Method>